<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>


    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400italic,600italic,700italic,200,300,400,600,700,900">
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-queue/3.0.7/d3-queue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.0/topojson.min.js"></script>
    <style>
        .continent {
            fill: #f0e4dd;
            stroke: #e0cabc;
            stroke-width: 0.5;
        }

        .circles {
            fill: #3c373d;
        }

        .labels {
            font-family: sans-serif;
            font-size: 11px;
            fill: #3c373d;
        }
    </style>
</head>

<body>
    <input id="menu" type="range" min="1908" max="2009" step="1" value="1908" />
    <div id="container" class="svg-container"></div>
    <script type="text/javascript">

        var w = 1400;
        var h = 1000;
        var width = w;
        var height = h;
        var initialData;

        var svg = d3.select("div#container").append("svg").attr("preserveAspectRatio", "xMinYMin meet").style("background-color", "#c9e8fd")
            .attr("viewBox", "0 0 " + w + " " + h)
            .classed("svg-content", true);
        var projection = d3.geo.mercator().translate([w / 2, h / 2]).scale(200).center([0, 40]);
        var path = d3.geo.path().projection(projection);



        d3.json("countries.geojson", function (values) {
            svg.selectAll("path")
                .data(values.features)
                .enter()
                .append("path")
                .attr("class", "continent")
                .attr("d", path);

            d3.csv("dataset_enhanced.csv", function (csv) {
                initialData = csv;
                drawAllData();
                drawFilteredData();
            });
        });



        function drawAllData() {
            svg.selectAll("circle")
                .data(initialData)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return projection([d.Lon, d.Lat])[0];
                })
                .attr("cy", function (d) {
                    return projection([d.Lon, d.Lat])[1];
                })
                .attr("r", 2)
                .attr("class", "alldata");
        };

        function drawFilteredData() {
            d3.selectAll(".filtered")
                .remove();

            var selectedYear = document.getElementById("menu").value;
            console.log("Drawing year ", selectedYear);

            var filteredData = initialData.filter(function (d) { return d.Year == selectedYear; });

            var filtered = svg.selectAll(".filtered")
                .data(filteredData)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return projection([d.Lon, d.Lat])[0];
                })
                .attr("cy", function (d) {
                    return projection([d.Lon, d.Lat])[1];
                })
                .attr("r", 4)
                .attr("fill", "red")
                .attr("class", "filtered");
        }
        /*
    openings
        .on("mouseover", function (d) {
            tooltip.transition()
                .duration(250)
                .style("opacity", 1);
            tooltip.html(
                "<p><strong>" + d.city + ", " + d.state + "</strong></p>"
            )
                .style("left", (d3.event.pageX + 15) + "px")
                .style("top", (d3.event.pageY - 28) + "px");
        })
        .on("mouseout", function (d) {
            tooltip.transition()
                .duration(250)
                .style("opacity", 0);
        });

        d3.select(".year").text("Year: " + selectedYear);

        var countByYear = d3.nest()
            .key(function (d) { return d.year; })
            .rollup(function (values) { return values.length; })
            .entries(filteredData);

        d3.select(".count")
            .text(function (d, i) {
                return "New Stores: " + countByYear[i].values
            });

            };*/

        d3.select("#menu")
            .on("input", function () {
                drawFilteredData();
            });

//d3.select(self.frameElement).style("height", "675px");


    </script>

</body>

</html>